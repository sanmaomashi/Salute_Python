
# 文件

## 1. 文件的概念和作用

- 计算机的文件，就是存储在某种长期储存设备上的一段数据
- 长期存储设备包括：硬盘、U 盘、移动硬盘、光盘...

文件的作用：将数据长期保存下来，在需要的时候使用

|                             CPU                              |                             内存                             |                             硬盘                             |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![](/Users/zhougaofeng/Desktop/Salute_系列/Salute_Python/img/11.jpg) | ![12](/Users/zhougaofeng/Desktop/Salute_系列/Salute_Python/img/12.jpg) | ![13](/Users/zhougaofeng/Desktop/Salute_系列/Salute_Python/img/13.jpg) |

## 2. 文件的存储方式

- 在计算机中，文件是以二进制的方式保存在磁盘上的

- 文本文件
  - 可以使用文本编辑软件查看
  - 本质上还是二进制文件
  - 例如：python 的源程序
- 二进制文件
  - 保存的内容 不是给人直接阅读的，而是提供给其他软件使用
  - 例如：图片文件、音频文件、视频文件等等
  - 二进制文件不能使用文本编辑软件查看

## 3. 文件的基本操作

### 3.1 操作文件的套路

在计算机中要操作文件的套路非常固定，一共包含三个步骤：

1. 打开文件
2. 读、写文件
   - **读** 将文件内容读入内存
   - **写** 将内存内容写入文件
3. 关闭文件

### 3.2 操作文件的函数/方法

- 在Python中要操作文件需要记住 1 个函数和 3 个方法

| 序号 | 函数/方法 |              说明              |
| :--: | :-------: | :----------------------------: |
|  01  |   open    | 打开文件，并且返回文件操作对象 |
|  02  |   read    |      将文件内容读取到内存      |
|  03  |   write   |       将指定内容写入文件       |
|  04  |   close   |            关闭文件            |

- `open` 函数负责打开文件，并且返回文件对象
- `read`/`write`/`close` 三个方法都需要通过文件对象来调用

`文件指针`

- 文件指针标记从哪个位置开始读取数据
- 第一次打开文件时，通常文件指针会指向文件的开始位置
- 当执行了read方法后，文件指针会移动到读取内容的末尾
  - 默认情况下会移动到文件末尾

- 第一次读取之后，文件指针移动到了文件末尾，再次调用不会读取到任何的内容

#### 3.2.1 read 方法 - 读取文件

- open函数的第一个参数是要打开的文件名（文件名区分大小写）
  - 如果文件存在，返回文件操作对象
  - 如果文件不存在，会抛出异常
- read方法可以一次性读入并返回文件的所有内容

**提示**

- 频繁的移动文件指针，会影响文件的读写效率，开发中更多的时候会以 只读、只写的方式来操作文件

a. `read` 方法 - 按行读取文件内容

- 默认会把文件的所有内容一次性读取到内存

- 如果文件太大，对内存的占用会非常严重

b. `readline` 方法

- `readline` 方法可以一次读取一行内容
- 方法执行后，会把文件指针移动到下一行，准备再次读取

**读取大文件的正确姿势**

```python
# 打开文件
file = open("README")
while True:
    # 读取一行内容
    text = file.readline()
    # 判断是否读到内容
    if not text:
        break
    # 每读取一行的末尾已经有了一个 `\n`
    print(text, end="")
# 关闭文件
file.close()
```

#### 3.2.2 close方法 - 负责关闭文件

- 如果 忘记关闭文件，会造成系统资源消耗，而且会影响到后续对文件的访问

- **注意**：`read` 方法执行后，会把文件指针移动到文件的末尾

```python
# 1. 打开 - 文件名需要注意大小写
file = open("README")
# 2. 读取
text = file.read()
print(text)
# 3. 关闭
file.close()
```

**提示**

- 在开发中，通常会先编写打开和关闭的代码，再编写中间针对文件的读/写操作！

#### 3.2.3 with方法

有的时候关闭文件的操作总是会被遗忘，我们有一个使用 "with"来操作文件的方式，它是一个上下文的操作，会帮你自动的关闭文件，代码示例如下：

```python
# as 指的是赋值
with open('a.txt', 'r', encoding='utf-8') as f:
    data = f.read()
    print(data)
```

除此之外，“with” 可以连续打开多个文件，代码示例如下：

```python
with open('a1.txt', 'r', encoding='utf-8') as f1, \
        open('a2.txt', 'r', encoding='utf-8') as f2:
    data1 = f1.read()
    data2 = f2.read()
```

## 3 文本模式打开文件的操作

- `open` 函数默认以只读方式打开文件，并且返回文件对象

语法如下：

```python
f = open("文件名", "访问方式")
```

| 访问方式 |                             说明                             |
| :------: | :----------------------------------------------------------: |
|    r     | 以**只读**方式打开文件。文件的指针将会放在文件的开头，这是默认模式。如果文件不存在，抛出异常 |
|    w     | 以**只写**方式打开文件。如果文件存在会被覆盖。如果文件不存在，创建新文件 |
|    a     | 以**追加**方式打开文件。如果该文件已存在，文件指针将会放在文件的结尾。如果文件不存在，创建新文件进行写入 |
|    r+    | 以**读写**方式打开文件。文件的指针将会放在文件的开头。如果文件不存在，抛出异常 |
|    w+    | 以**读写**方式打开文件。如果文件存在会被覆盖。如果文件不存在，创建新文件 |
|    a+    | 以**读写**方式打开文件。如果该文件已存在，文件指针将会放在文件的结尾。如果文件不存在，创建新文件进行写入 |

### 3.1 操作文件“r”模式

全部读取使用read，代码示例如下：

```python
f = open('a.txt', mode='r', encoding='utf-8')  # “r”模式下，如果文件不存在会报错
# f.write('哈哈') #抛出异常，不能写
print(f.readable())  # 判断是否可读
print('=============>1')
print(f.read())  # 全部读取
print('=============>2')
# 读文件会有一个光标移动，第一次读完了，光标移至末尾，第二次读无内容
print(f.read())
f.close()
```

一行一行读文件内容使用readline，代码示例如下：

```python
f = open('a.txt', mode='r', encoding='utf-8')
# readline指的是一行一行读文件
print(f.readline(), end='')  # 文件中有换行，print也自带换行，指定end参数去掉默认换行
print(f.readline(), end='')
print(f.readline(), end='')
f.close()
```

全部读取文件内容，存入列表，每行内容为列表的一个元素使用readlines，代码示例如下：

```python
f = open('a.txt', mode='r', encoding='utf-8')

print(f.readlines()) 
f.close()
```

readlines可以加数字作为参数，但是他不是指的行数，而是字节数，所以我们一般不用，如需逐行打印文件内容常用readlines与for循环连用，代码示例如下：

```python
# 如果文件内容比较少的时候，以下两种方式都可以

with open('a.txt') as f:
    # 当文件很大时，f.readlines()结果是一个很大的列表在内存中，机器就卡了
    for line in f.readlines(): 
        print(line, end='')

# 推荐使用这种方式
with open('a.txt') as f:  # f是一个可迭代对象，就像老母鸡会下蛋一样 
    for line in f:  
        # 文件内容很大时，使用这种方式每次内存中只有一行内容
        print(line, end='')
```

### 3.2 操作文件“w”模式

注意：在“w”只写模式下，当文件存在时，就会清空该文件，代码示例如下：

```python
f = open(r'a.txt', mode='w', encoding='utf-8')  # 默认是wt
f.write('第一行\n')  # 需要自己添加“\n”来换行
f.write('第二行\n')
f.close()
```

当文件不存在时，就会创建空文档，代码示例如下：

```python
f = open(r'a1.txt', mode='w', encoding='utf-8')  # 默认是wt
f.write('第一行\n')
f.write('第二行\n')
f.close()
```

只写模式常用的方法：

```python
f = open(r'a1.txt', mode='w', encoding='utf-8')  # 默认是wt

f.writable()
# writelines指的是可以放一个列表或者元组，里面可以有多行内容，需要自己加换行符
f.writelines(['111111\n', '222222\n', '333333\n'])
# 下面这样代码与上面写的结果一样
# f.write('aaaaaa\nbbbbbbb\ncccccc\n')
f.close()
```

### 3.3 操作文件“a”模式

“a”模式指的是只追加写，当文件不存在时，创建空文件；当文件存在时，光标直接移至文件末尾，所以，我们在记录日志的时候都会使用“a”模式，代码示例如下：

```python
f = open('access.log', mode='a', encoding='utf-8')
print(f.writable())
print(f.readable())
f.write('5555555555555\n')
f.close()
```

### 3.4 二进制“b”模式基本介绍

“b”模式指的是文件打开的模式为“b”模式， 它与“t”模式类似，不能单独使用，必须以“rb”，“wb”或者“ab”模式来使用，“b”模式读写都是以bytes为单位进行的，所以可以理解为“b”模式就是二进制模式。对于普通文本来说是以字符的形式保存的，但是对于图片，视频或者音频等等这些文件则是以二进制形式保存的，所以“t”模式无法读取

图片文件并不是以字符编码保存的，而是以JPG这个格式保存成了二进制形式，与字符编码没有关系，所以我们以文本模式处理文件是不可行的。应该以二进制模式打开文件，这时不需要指定字符编码，正确的打开方式请看如下代码示例：

```python
# b模式下一定不能指定encoding参数
with open('01.jpg', 'rb', ) as f:
    data = f.read()
    print(data)
```

**强调：**

1、与t模式类似，不能单独使用，必须是rb，wb，ab

2、b模式下读写都是以bytes单位的

3、b模式下一定不能指定encoding参数，不指定encoding参数默认为二进制

4、b模式（二进制）可以读取文字，图片，视频，什么文件都可以（因为所有类型的数据都要以二进制形式存在硬盘中）

### 3.5 操作二进制文件的“rb”模式

需要说明的一点是，“b”模式也可以读取文本文件，字符的底层都是以二进制形式存储的，只不过你在使用“t”模式读取文本文件的时候open帮你把二进制转成了能够看懂的文本，这是“t”模式的便利之处，但是它有局限性，只能操作文本文件，而“b”模式具有统一性，任何文件底层存储原理都是二进制，这也就是意味着“b”模式可以操作任何文件，代码示例如下：

```python
with open('01.jpg', 'rb', ) as f1, open('a.txt', 'rb') as f2:
    img = f1.read()
    text = f2.read()
    print(text.decode('utf-8'))  # 把bytes转化成utf-8
```

### 3.6 操作文件的“wb”模式

“wb”模式也是操作文件“w”模式的一种，当文件存在时，就会清空该文件，当文件不存在时，就会创建空文件，比如当你需要对一个文档重写时就会用到。代码示例如下：

```python
# wb模式写入
with open('a.txt', 'wb') as f:
    msg = '你好，世界'
    f.write(msg.encode('utf-8'))  # 指定写入文件的字符编码

# rb模式读取
with open('a.txt', 'rb') as f:
    data = f.read()
    print(data)
    print(type(data))
    print(data.decode('utf-8'))  # 指定读取文件的字符编码
```

### 3.7 操作文件的“ab”模式

“ab”模式指的是以二进制形式追加写，与操作文件的“a”模式同理，代码示例如下：

```python
with open('a.txt', 'ab') as f:
    msg = '\n世界：你也好，小鬼'
    f.write(msg.encode('utf-8'))  # 指定写入文件的字符编码
```

### 3.8 其他

一般来说，你遇到的操作文件的模式都是只读或者只写，但是也有可读可写的模式，这类模式了解即可，说明和代码示例如下：

```python
# "r+t"模式，或者写成"r+"模式，指的是可读可写
with open('a.txt', 'r+t', encoding='utf-8') as f:
    print(f.readable())
    print(f.writable())

# "w+r"或者"w+"模式，可读可写
with open('a.txt', 'w+t', encoding='utf-8') as f:
    print(f.readable())
    print(f.writable())

# "a+t"或者"a+"，可读可追加写
with open('a.txt', 'a+t', encoding='utf-8') as f:
    print(f.readable())
    print(f.writable())

# "U"模式，通用换行符，已废弃，无需了解
# with open('a.txt', 'U', encoding='utf-8') as f:
#     print(f.readable())
#     print(f.writable())
```

“r+”与“w+”，“a+”模式都是可读可写，他们的区别在于不改变自身原本操作文件的形式，即“r+”模式下，当文件不存在会报错，“w+”或者“a+”模式当文件不存在会创建新文件，当文件存在时w+会清空文件，a+会在写入时追加内容。

### 3.9 文件内光标移动

在打开文件时会有一个光标移动，我们使用seek这个方法，可以实现光标的移动，代码示例如下：

```python
with open('a.txt', 'r') as f:
    f.seek(9)  # 这个参数指的是偏移量，以字节为单位
    data = f.read()
    print(data)
```

注意：光标移动只能是从左往右移动，seek可以加两个参数，第一个参数就是上面代码中的参数，你如果只传一个参数也就是指的这个参数，第二个参数默认是0，指的是光标在文件开头位置开始移动，除了0之外，只能接收1或者2作为参数，1表示从当前位置开始移动，2表示从文件末尾开始移动，其中1和2必须在“b”模式下进行，0可以在“t”模式或者“b”下都能运行，但是无论哪种模式，都是以bytes为单位进行的，代码示例如下：

```python
with open('a.txt', 'rb') as f:
    f.seek(3, 0)  # 移动三个字节，也就是utf-8编码下一个中文字符
    print(f.tell())  # 当前光标位置，以字节为单位
    f.seek(3, 1)  # 从当前位置向右偏移3个字节然后再读取文件内容
    # f.seek(3, 2)  # 只能读取动态数据新添加的内容
    data = f.read()
    print(data.decode('utf-8'))

with open('a.txt', 'r') as f:
    f.seek(3, 0)
    print(f.read())
```

## 4. 复制文件

### 4.1 小文件复制

- 打开一个已有文件，读取完整内容，并写入到另外一个文件

```python
# 1. 打开文件
file_read = open("README")
file_write = open("README[复件]", "w")
# 2. 读取并写入文件
text = file_read.read()
file_write.write(text)
# 3. 关闭文件
file_read.close()
file_write.close()
```

### 4.2 大文件复制

- 打开一个已有文件，逐行读取内容，并顺序写入到另外一个文件

```python
# 1. 打开文件
file_read = open("README")
file_write = open("README[复件]", "w")

# 2. 读取并写入文件
while True:
    # 每次读取一行
    text = file_read.readline()
    # 判断是否读取到内容
    if not text:
        break
    file_write.write(text)
# 3. 关闭文件
file_read.close()
file_write.close()
```

## 5. 文件/目录的常用管理操作

- 在终端/文件浏览器中可以执行常规的文件/目录管理操作，例如：
  - 创建、重命名、删除、改变路径、查看目录内容、……
- 在Python中，如果希望通过程序实现上述功能，需要导入os模块

1. 文件操作

| 序号 | 方法名 | 说明       | 示例                              |
| :--- | :----- | :--------- | :-------------------------------- |
| 01   | rename | 重命名文件 | `os.rename(源文件名, 目标文件名)` |
| 02   | remove | 删除文件   | `os.remove(文件名)`               |

2. 目录操作

| 序号 | 方法名     | 说明           | 示例                      |
| :--- | :--------- | :------------- | :------------------------ |
| 01   | listdir    | 目录列表       | `os.listdir(目录名)`      |
| 02   | mkdir      | 创建目录       | `os.mkdir(目录名)`        |
| 03   | rmdir      | 删除目录       | `os.rmdir(目录名)`        |
| 04   | getcwd     | 获取当前目录   | `os.getcwd()`             |
| 05   | chdir      | 修改工作目录   | `os.chdir(目标目录)`      |
| 06   | path.isdir | 判断是否是文件 | `os.path.isdir(文件路径)` |

> 提示：文件或者目录操作都支持相对路径和绝对路径
